<!DOCTYPE html>
<html>
<head>
    <title>Professional Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #3e0547d4;
            color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .quiz-container {
            background: #fff;
            padding: 60px 80px;
            border-radius: 12px;
            width: 600px;
            box-shadow: 0 0 20px #000;
        }
        h2 {
            margin-bottom: 20px;
        }
        .options label {
            display: block;
            background: #362f2f;
            color: #fff;
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .options label:hover {
            background: #505050;
        }
        button {
            padding: 12px 25px;
            margin-top: 20px;
            background: #452466;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #833fc7;
        }
        .progress {
            margin-bottom: 20px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js"></script>
</head>
<body>

<div class="quiz-container">
    <div class="progress" id="progress">Question 1 / 10</div>
    <h2 id="question">Loading...</h2>
    <div class="options" id="options"></div>
    <button id="nextBtn">Next</button>
    <div id="result"></div>
    <button id="backBtn">Back</button>
</div>

<script>
let questions = [];
let current = 0;
let userAnswers = [];
let quizFinished = false;

// BACK button
document.getElementById("backBtn").addEventListener("click", () => {
    if (quizFinished) {
        window.location.href = "quiz.html";
    } else if (current > 0) {
        current--;
        showQuestion();
        updateProgress();
    }
});

// Load questions from server
async function loadQuestions() {
    const res = await fetch("/api/get_questions");
    questions = await res.json();
    showQuestion();
    updateProgress();
}

// Show question
function showQuestion() {
    const q = questions[current];
    document.getElementById("question").innerText = he.decode(q.question);
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";

    [q.option1, q.option2, q.option3, q.option4].forEach(opt => {
        const decodedOpt = he.decode(opt);
        const label = document.createElement("label");
        const checked = userAnswers[current] === decodedOpt ? "checked" : "";
        label.innerHTML = `<input type="radio" name="answer" value="${decodedOpt}" ${checked}> ${decodedOpt}`;
        optionsDiv.appendChild(label);
    });
}

// Update progress
function updateProgress() {
    document.getElementById("progress").innerText = `Question ${current + 1} / ${questions.length}`;
}

// NEXT button
document.getElementById("nextBtn").addEventListener("click", async () => {
    const selected = document.querySelector('input[name="answer"]:checked');
    if (!selected) return alert("Please select an answer!");

    // Save answer (trimmed)
    userAnswers[current] = selected.value.trim();

    current++;
    if (current < questions.length) {
        showQuestion();
        updateProgress();
    } else {
        quizFinished = true;
        document.getElementById("question").style.display = "none";
        document.getElementById("options").style.display = "none";
        document.getElementById("nextBtn").style.display = "none";
        document.getElementById("progress").innerText = "Quiz Finished!";

        // Send answers to backend
        const res = await fetch("/api/check_answers", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(
                userAnswers.reduce((acc, val, i) => ({ ...acc, [`q${i}`]: val }), {})
            )
        });
        const data = await res.json();
        document.getElementById("result").innerHTML =
            `<h1>You got ${data.correct} out of ${data.total} correct!</h1>
             <p>Score: ${data.score}%</p>`;
    }
});

loadQuestions();
</script>

</body>
</html>
